<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.Semicolon.pms.dao.ReplyDAO">
    <resultMap id="replyMap" type="com.Semicolon.pms.dto.ReplyDto">
        <id property="replyNumber" column="REPLY_NUMBER" />
        <result property="bno" column="BNO" />
        <result property="userId" column="USERID" />
        <result property="replyContent" column="REPLY_CONTENT" />
        <result property="regDate" column="REG_DATE" />
        <result property="updateDate" column="UPDATE_DATE" />
        <result property="engId" column="ENG_ID" />
        <result property="groupId" column="GROUP_ID" />
    </resultMap>

    <select id="getRepliesByIssueId" parameterType="String" resultMap="replyMap">
        SELECT * FROM REPLY WHERE BNO = #{bno} ORDER BY REG_DATE ASC
    </select>
    
    <insert id="insertReply" parameterType="com.Semicolon.pms.dto.ReplyDto">
        INSERT INTO REPLY (
            REPLY_NUMBER,
            BNO,
            USERID,
            REPLY_CONTENT,
            REG_DATE,
            UPDATE_DATE,
            ENG_ID,
            GROUP_ID
        ) VALUES (
            REPLY_SEQ.NEXTVAL,
            #{bno},
            #{userId},
            #{replyContent},
            SYSDATE,
            SYSDATE,
            #{engId, jdbcType=VARCHAR},
            #{groupId, jdbcType=VARCHAR}
        )
    </insert>

    <delete id="deleteReply" parameterType="int">
        DELETE FROM REPLY WHERE REPLY_NUMBER = #{replyNumber}
    </delete>

    <delete id="deleteRepliesByIssueId" parameterType="String">
        DELETE FROM REPLY WHERE BNO = #{bno}
    </delete>
</mapper>